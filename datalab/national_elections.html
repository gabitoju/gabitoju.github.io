<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<meta name="HandheldFriendly" content="True">
		<meta name="MobileOptimized" content="320">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Elecciones Nacionales en Uruguay</title>		
		
		<meta name="twitter:card" value="summary">
		<meta name="twitter:image" content="http://gabitoju.uy/datalab/img/national_elections.png">
		<meta name="twitter:creator" content="@gabitoju"> 
		<meta name="twitter:site" content="@gabitoju"> 
		<meta property="og:title" content="Elecciones Nacionales en Uruguay" /> 
		<meta property="og:type" content="article" />
		<meta property="og:url" content="http://gabitoju.uy/datalab/national_elections.html" />
		<meta property="og:image" content="http://gabitoju.uy/datalab/img/national_elections.png" />
		<meta property="og:description" content="¿Cómo fue cambiando el panorama político en cada departamento entre 1984 y 2014?" />
		

		<link href="css/style.css" rel="stylesheet">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-glyphicons.css" rel="stylesheet">
		<script type="text/javascript" src="js/jquery.min.js"></script>
	</head>
	<body>
		<div class="container">
			<div class="page-header">
				<div class="container">
					<div class="row">
						<a href="/"><h1>gabitoju</h1></a>
					</div>
				</div>
			</div>					
			<div class="container">
				<div class="row">
					<div id="fb-root"></div>
<div class="col-lg-12">
	<div class="row">
		<a href="/datalab">Volver a Data Lab</a>
	</div>
	<div class="row">
		<div class="col-lg-12">
			<h1>Elecciones Nacionales en Uruguay</h1>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-12">
		<p>El domingo 26 de Octubre del 2014 se desarrollaron en Uruguay las elecciones nacionales con el propósito de elegir al Presidente y
Vice Presidente de la República así como a Senadores y Diputados.</p>
<p>Estas elecciones fueron marcadas por hechos tales como el crecimiento a nivel departamental del Frente Amplio (ganó en 14 de 19 departamentos),
un magro resultado para el Partido Colorado (12,9% de los votos) y un hecho significativo: los modelos aplicados por las encuestadoras fallaron
en representar un escenario como el que se dio, amplia mayoría del FA y un pobre desempeño de los partidos tradicionales.</p>
<p>Estas visualizaciones pretenden mostrar como ha sido la evolución de cada departamento desde 1984 hasta el 2014 en función de la fuerza política que ganó en cada uno de ellos. Los datos están disponibles <a href="data/national_elections.csv">aquí</a> y fueron obtenidos de la <a href="http://www.corteelectoral.gub.uy/">Corte Electoral</a>.</p>
<div class="row">
    <div class="col-md-2">
        <form class="form-inline" role="form">
            <div class="form-group">
                <label class="control-label" for="election_years">Año: </label>
                <select class="form-control" id="election_years"></select>
            </div>
        </form>        
    </div>
    <div class="col-md-2">
        <button type="button" class="btn btn-success btn-lg" id="play">
          <span class="glyphicon glyphicon-play-circle"></span> Iniciar
        </button>    
    </div>
    <div class="col-md-8">
        <span class="pn">Partido Nacional</span>
        <span class="pc">Partido Colorado</span>
        <span class="fa">Frente Amplio</span>
    </div>
</div>

<div class="row">    
    <div class="col-md-8">
        <div class="row">
            <div id="map"></div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="row">
            <h3 class="pull-right" id="elections"></h3>
        </div>
        <div class="row pull-right">
            <table class="table table-striped table-condensed" id="data">
                <thead>
                    <th>Departamento</th>
                    <th>Partido</th>
                    <th>Votos</th>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <form class="form-inline" role="form">
            <div class="form-group">
                <label class="control-label" for="dpto">Departamento: </label>
                <select class="form-control" id="dpto"></select>
            </div>
        </form>               
        <div id="chart"></div>
    </div>
    <div class="col-md-6">
        <div id="lines"></div>
    </div>
</div>

<h3><a name="1"></a>Tecnologías usadas</h3>
<p>La visualización de mapas fue hecha con <a href="https://developers.google.com/chart/interactive/docs/gallery/geochart">Google Geochart</a>.</p>
<p>Para generar las gráficas se usaron los componentes BarChart y LineChart y  de la librería <a href="http://www.webdetails.pt/ctools/ccc.html">Community Charting Components</a> de WebDetails.</p>
<p>El manejo general de datos se hace con <a href="http://d3js.org">D3</a>.</p>
<style>
    .pc {
        color: #B91C09;
    }
    .pn {
        color: #009ADA;
    }
    .fa {
        color: #006;
    }
</style>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.8/d3.min.js" charset="utf-8"></script>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<p><link type="text/css" href="/datalab/ccc/tipsy.css" rel="stylesheet" media="screen"/>
<script type="text/javascript" src="/datalab/ccc/jquery.tipsy.js"></script>
<script type="text/javascript" src="/datalab/ccc/protovis.js"></script>
<script type="text/javascript" src="/datalab/ccc/protovis-msie.js"></script>
<script type="text/javascript" src="/datalab/ccc/tipsy.js"></script>
<script type="text/javascript" src="/datalab/ccc/def.js"></script>
<script type="text/javascript" src="/datalab/ccc/pvc-r2.0.js"></script></p>
<script type="text/javascript">

    var departments = [
        'Todos',
        'Artigas',
        'Canelones',
        'Cerro Largo',
        'Colonia',
        'Durazno',
        'Flores',
        'Florida',
        'Lavalleja',
        'Maldonado',
        'Montevideo',
        'Paysandú',
        'Río Negro',
        'Rivera',
        'Rocha',
        'Salto',
        'San José',
        'Soriano',
        'Tacuarembó',
        'Treinta y Tres',
    ];


    $(document).ready(function () {
        for (var i in years) {
            var year = years[i];
            $('#election_years').append('<option value="' + year + '">' + year + '</option>');
        }
        $('#election_years').change(function () {
            draw_map(null, $(this).val());
        });        

        for (var i in departments) {
            var d = departments[i];
            $('#dpto').append('<option value="' + d + '">' + d + '</option>');
        }
        $('#dpto').change(function () {
            draw_chart($(this).val());
        });        

        var y = 1;
        var interval = 0;
        $('#play').click(function () {
            var that = this;
            if (interval != 0) {
                clearInterval(interval);
                interval = 0;
                $(this).find('span').removeClass('glyphicon-pause');
                $(this).find('span').addClass('glyphicon-play-circle');
                $(this).contents().last()[0].textContent = ' Iniciar';
            }
            else {
                if (y === 1) {
                    draw_map(null, years[0]);
                }
                interval = setInterval(function () {
                    if (y < years.length) {
                        draw_map(null, years[y++]);
                    }
                    else {
                        $(that).find('span').removeClass('glyphicon-pause');
                        $(that).find('span').addClass('glyphicon-play-circle');
                        $(that).contents().last()[0].textContent = ' Iniciar';
                        clearInterval(interval);
                        interval = 0;
                        y = 1;
                    }
                }, 1500);
                $(this).find('span').removeClass('glyphicon-play-circle');
                $(this).find('span').addClass('glyphicon-pause');              
                $(this).contents().last()[0].textContent = ' Pausar';
            }
            $(this).blur();
        });
        d3.csv("data/national_elections.csv", function (csv_data) {            
            win_data = csv_data;
            $('#dpto').change();
        });
    });

    google.load('visualization', '1', { 'packages': ['geochart'] });
    google.setOnLoadCallback(draw_map);

    var years = [1984, 1989, 1994, 1999, 2004, 2009, 2014];
    var parties = {
        'PN': 1,
        'PC': 2,
        'FA': 3
    }
    var parties_des = {
        'PN': 'Partido Nacional',
        'PC': 'Partido Colorado',
        'FA': 'Frente Amplio'
    }

    function draw_chart(d) {
        var csv_data = win_data;
        var full_data = {
            resultset: [],
            metadata: [
            {
                colIndex: 0,
                colType: "String",
                colName: "Partido"
            },
            {
                colIndex: 1,
                colType: "String",
                colName: "Año"
            },
            {
                colIndex: 2,
                colType: "Numeric",
                colName: "Votos"
            }]
        }


        for (var i in csv_data) {
            var obj = csv_data[i];

            if (d === 'Todos' || d === obj.Department) { 
                var set = [obj.Party, obj.Year, obj.Votes];
                full_data.resultset[full_data.resultset.length] = set;                 
                var set2 = [obj.Party2, obj.Year, obj.Votes2];
                full_data.resultset[full_data.resultset.length] = set2;                
                var set3 = [obj.Party3, obj.Year, obj.Votes3];
                full_data.resultset[full_data.resultset.length] = set3;                    
                var set4 = ['Otros', obj.Year, obj.Others];
                full_data.resultset[full_data.resultset.length] = set4;                    
            }               
        }
        var colors = [];
        switch (full_data.resultset[0][0]) {
            case 'PC':
                colors = ['#B91C09', '#009ADA', '#006'];
                break;
            case 'PN':
                colors = ['#009ADA', '#B91C09', '#006'];
                break;
            case 'FA': 
                colors = ['#006', '#009ADA', '#B91C09'];
                break;
        }

        if (d === 'Montevideo') {
            colors = ['#B91C09', '#006', '#009ADA'];
        }

        colors[colors.length] = '#4CAE4C';

        new pvc.BarChart({
            canvas: 'chart',
            width:  500,
            height: 400,

            crosstabMode: false,

            stacked: true,
            barStackedMargin: 3,
            valuesVisible: true,
            valuesOptimizeLegibility: true,
            valuesFont: 'lighter 11px "Open Sans"',
            plotFrameVisible: false,

            // Cartesian axes
            axisGrid:   true,
            axisOffset: 0,
            axisGrid_strokeStyle: '#F7F8F9',
            axisLabel_font: 'normal 10px "Open Sans"',
            baseAxisTicks: true,
            baseAxisTooltipAutoContent: 'summary',
            axisRule_strokeStyle: '#DDDDDD',

            // Panels
            legend: true,
            legendFont: 'normal 11px "Open Sans"',

            // Rubber-band
            rubberBand_strokeStyle: 'rgb(0,0,240)',
            rubberBand_fillStyle:   'rgba(0,0,255, 0.5)',
            rubberBand_lineWidth:   2.5,

            // Chart/Interaction
            animate:    true,
            selectable: true,
            hoverable:  true,

            // Color axes
            colors: colors
        }).setData(full_data).render();            

        new pvc.LineChart({
            canvas: 'lines',
            width:  500,
            height: 400,

            // Data source
            crosstabMode: false,

            areasVisible: false,
            linesVisibles: true,
            nullInterpolationMode: "linear",
            dotsVisible:  true,
            dot_shapeSize:  7,               

            // Cartesian axes
            axisGrid:   true,
            axisGrid_strokeStyle: '#F7F8F9',
            axisLabel_font: 'normal 9px "Open Sans"',
            legend: true,
            legendFont: 'normal 11px "Open Sans"',

            // Chart/Interaction
            animate:    true,
            selectable: true,
            hoverable:  true,

            // Color axes
            colors: colors
        }).setData(full_data).render();            
    }

    function draw_map(e, year) {

        year = typeof year !== 'undefined' ? year : 2014;
        $('#election_years').val(year);

        d3.csv("data/national_elections.csv", function (csv_data) {            
            win_data = csv_data; 
            $('#elections').text('Elecciones Nacionales ' + year);

            var data = new google.visualization.DataTable();                      
            data.addRows(19);
            data.addColumn('string', 'Departamento');
            data.addColumn('string', 'Partido');
            data.addColumn('number', 'Votos');            

            var d = 0;
            $('#data > tbody').empty();
            for (var i in csv_data) {
                var obj = csv_data[i];
                if (obj.Year == year) {
                    data.setValue(d, 0, obj.Department);
                    data.setValue(d, 1, obj.Department + ': ' + obj.Party);
                    data.setValue(d, 2, parties[obj.Party]);
                    data.setFormattedValue(d, 2, obj.Votes);                    
                    d++;               
                    var votes = parseInt(obj.Votes).toLocaleString();
                    $('#data > tbody').append('<tr><td>' + obj.Department + '</td><td>' + obj.Party + '</td><td>' + votes + '</td></tr>');
                }                     
            }            
            var options = {
                region: 'UY',
                displayMode: 'regions',
                resolution: 'provinces',
                colorAxis: {minValue:1, maxValue: 3, colors: ['#009ADA', '#B91C09', '#006']},                
                legend: 'none',               
                backgroundColor: 'transparent'
            }

            var chart = new google.visualization.GeoChart(document.getElementById('map'));       
            drawListener = google.visualization.events.addListener(chart, 'ready', function(eventData){drawStroke();});            

            // Based on https://code.google.com/p/google-visualization-api-issues/issues/attachmentText?id=717&aid=7170004000&name=map.html&token=ABZ6GAehI7pIMsXBnsNTf-BFc69xLCYLVQ%3A1415044406135
            function drawStroke(){
                google.visualization.events.removeListener(drawListener); //remove listener so stroke is not drawn infinitely                
                paths = $('#map path');
                for(i=0;i<paths.length;i++){ //change attributes on all paths to draw borders
                        paths[i].setAttribute('stroke','#000000');
                        paths[i].setAttribute('stroke-width','0.75');
                }
                //had to add extra code to avoid it looking like shit in IE
                if(navigator.appName=="Microsoft Internet Explorer"){
                        shapes =  $('#map shape');
                        for(i=0;i<shapes.length;i++){
                                shapes[i].setAttribute('strokecolor','#000');
                        }
                }
            }
            chart.draw(data, options);
        });        

    }
</script>
		</div>
	</div>
	<div clas="row">
		<div class="col-lg-1">
			<a href="https://twitter.com/share" class="twitter-share-button" data-via="gabitoju" data-lang="es">Twittear</a>
		</div>
		<div class="col-lg-1">
			<div class="fb-like" data-layout="button" data-action="like" data-show-faces="false" data-share="true"></div>
		</div>
		<div class="col-lg-1">
			<div class="g-plus" data-action="share" data-annotation="none"></div>
		</div>
		<div class="col-lg-2">
			<script src="//platform.linkedin.com/in.js" type="text/javascript">
					lang: es_ES
			</script>
			<script type="IN/Share" data-counter="right"></script>
		</div>		
	</div>

	<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'gabitoju'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
</div>
<a href="//plus.google.com/u/0/112455652268886475364?prsrc=3" rel="author"></a>
<script>
    $(window).bind("load", function() {
       $.getScript('js/social.js', function() {});
    });
</script>
				
				</div>
			</div>
		</div>		    
	    <script type="text/javascript" src="js/bootstrap.min.js"></script>
	    <script type="text/javascript">
	        
	          var _gaq = _gaq || [];
	          _gaq.push(['_setAccount', 'UA-33409917-1']);
	          _gaq.push(['_trackPageview']);
	        
	          (function() {
	            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	          })();
	        
	    </script>        
		<a href="https://github.com/gabitoju"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
	</body>
</html>
